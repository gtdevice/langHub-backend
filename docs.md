# LangHub Backend Documentation

This document provides a comprehensive overview of the LangHub backend, designed to facilitate AI-driven development.

## Project Overview

LangHub is a language learning platform that helps users improve their skills by reading articles and engaging in AI-powered conversations. The backend is built with FastAPI and leverages Supabase for the database and user authentication, and OpenRouter for Large Language Model (LLM) integration.

The core user flow is as follows:
1.  A user selects an article based on their language, level, and interests.
2.  The user starts a dialog with an AI coach about the selected article.
3.  The AI coach provides corrections, explanations, and follow-up questions to guide the user's learning.

## Important conciderations

the project is an indie prodject with 1 developer. Project must be super simple. less code is better. No need in any enterprize solutions.

## Features

- **User Authentication:** Secure user management with Supabase.
- **Article Management:** Articles can be filtered by language, level, and category.
- **Content Adaptation:** Articles are adapted to different languages and proficiency levels.
- **AI-Powered Dialogs:** Interactive conversations with an AI language coach.
- **Personalized Learning:** Each user has their own private dialog for each article.
- **User Settings:** Store user configuration data such as main language, learning language, language level, and preferred categories.

## Architecture

- **Framework:** FastAPI
- **Database:** Supabase (PostgreSQL)
- **Authentication:** Supabase GoTrue
- **LLM Integration:** OpenRouter
- **Deployment:** Configured for deployment on Render.

## API Endpoints

The main API endpoints are:

- `GET /articles`: Fetches a list of articles.
- `GET /dialogs/{articleId}`: Retrieves or creates a dialog for a specific article.
- `POST /dialogs/{dialogId}/messages`: Sends a message to a dialog and receives the updated list of messages for that dialog. The AI's response is generated by an LLM, which analyzes the user's message in the context of the conversation history and the article's vocabulary and grammar topics. The AI response includes a sample correction of the user's message and a follow-up question to continue the conversation.
- `GET /api/v1/user-settings/me`: Retrieves the current authenticated user's settings.
- `POST /api/v1/user-settings`: Creates new user settings for the authenticated user.
- `PUT /api/v1/user-settings/me`: Updates the current authenticated user's settings.
- `DELETE /api/v1/user-settings/me`: Deletes the current authenticated user's settings.

For more details, see the `plan.md` file.

## Database Schema

The database schema is designed to support the application's features. The main tables are:

- `articles`: Stores the original article content.
- `adapted_articles`: Stores versions of articles adapted for specific languages and levels.
- `dialogues`: Stores conversation threads between users and the AI coach.
- `messages`: Stores individual messages within a dialogue.
- `user_settings`: Stores user configuration data such as main language, learning language, language level, and preferred categories.

### User Settings Schema
The `user_settings` table contains:
- `id`: Primary key (integer)
- `user_id`: Foreign key to profiles table (UUID)
- `main_language`: User's native language (varchar)
- `learning_language`: Target language for learning (varchar)
- `language_level`: Proficiency level (varchar)
- `preferred_categories`: Array of preferred article categories (text[])
- `created_at`: Timestamp of creation
- `updated_at`: Timestamp of last update

For more details, see the `plan.md` file.

## Getting Started

To set up and run the project locally:

1.  **Install dependencies:**
    ```bash
    pip3 install -r requirements.txt
    ```
2.  **Set up environment variables:**
    Create a `.env` file in the root directory and add the following variables:
    ```
    SUPABASE_URL="your_supabase_url"
    SUPABASE_ANON_KEY="your_supabase_anon_key"
    SUPABASE_JWT_SECRET="your_supabase_jwt_secret"
    PROJECT_NAME="LangHub"
    OPENROUTER_API_KEY="your_openrouter_api_key"
    OPENROUTER_MODEL_NAME="your_openrouter_model_name"
    ```
3.  **Run the application:**
    ```bash
    uvicorn app.main:app --reload
